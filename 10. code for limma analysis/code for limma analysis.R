library(affy)
library(limma)
###??һ??txt?ļ???group??
phenoData=read.AnnotatedDataFrame(file.choose(),row.names = 1, sep = ",")
pheno=pData(phenoData)
###?ڶ???txt?ļ???expression
expreData=read.AnnotatedDataFrame(file.choose(),row.names = 1, sep = ",") # expression profile could be downloaded at Zenodo dataset
expre=pData(expreData)
#######
#????????
Group = factor(pheno$group,levels=c('High','Low'))
design = model.matrix(~0+Group)
colnames(design) <- c('High','Low')
design
#????ģ??????
fit <- lmFit(expre, design)
#?????ȶ?ģ?ͣ??Ƚ?��???????µı???????
contrast.matrix <- makeContrasts(High-Low,#1
                                 levels=design)

#####################
####################
library(xlsx)
library(futile.logger)
#?ȶ?ģ?ͽ??в?ֵ????
fit2 <- contrasts.fit(fit, contrast.matrix)
#??Ҷ˹????
fit2 <- eBayes(fit2)
#?ҳ????????????????????????????????Ľ???
diff = topTable(fit2,adjust.method="fdr",coef=1,p.value=0.05,
                lfc=log(2,2),number=5000,sort.by = 'logFC')
#output
write.xlsx2(diff,'DEG.xlsx')

rm(list = ls())



